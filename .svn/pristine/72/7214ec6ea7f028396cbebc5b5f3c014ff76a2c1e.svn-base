import java.io.IOException;
import java.util.ArrayList;


public class ShowItem {
	private MovieItem showMovie;
	private String showDate;
	private String showTime;
	private CineplexItem showCineplex;
	private CinemaItem showCinema;
	private ArrayList<BookingItem> showBooking;
	private SeatItem[][] showLayout;
	
	public ShowItem(MovieItem m, String d, String t, CineplexItem c, CinemaItem k){
		showMovie = m;
		showCineplex = c;
		showTime = t;
		showDate = d;
		showCinema = k;
		//initialize showLayout
		showLayout = new SeatItem[showCinema.getCinemaRow()][showCinema.getCinemaColumn()];
		for (int i = 0; i< showCinema.getCinemaRow() ; i++){				
			for (int j = 0 ; j < showCinema.getCinemaColumn(); j++){
				String seatId = String.valueOf(Constant.rowCode[j])+String.valueOf(i);
				showLayout[i][j]= new SeatItem(seatId);
			}
		}
		//show Booking
		showBooking = new ArrayList<BookingItem>();
		// add to Movie and Cineplex
		showCineplex.addShow(this);
		showMovie.addMovieShow(this);
	}
	
	public MovieItem getShowMovie(){
		return showMovie;
	}
	public String getShowDate(){
		return showDate;
	}
	public String getShowTime(){
		return showTime;
	}
	public CineplexItem getShowCineplex(){
		return showCineplex;
	}
	public CinemaItem getShowCinema(){
		return showCinema;
	}
	public ArrayList<BookingItem> getShowBooking(){
		return showBooking;
	}
	public String getShowInfo(){
		return showDate+"\t"+showTime+"\t"+showCinema.getCinemaCode()+"\t"+showCineplex.getCineplexName();
	}
	
	public void setShowMovie(MovieItem m){
		showMovie = m;
	}
	public void getShowDate(String d){
		showDate = d;
	}
	public void getShowTime(String t){
		showTime = t;
	}
	public void getShowCineplex(CineplexItem c){
		showCineplex = c;
	}
	public void getShowCinema(CinemaItem c){
		showCinema = c;
	}
	public void addShowBooking(BookingItem b){
		showBooking.add(b);
	}
	public void bookSeat(SeatItem seat){
		seat.assign();
	}
	public boolean validateSeatId(String seatId){
		boolean check = false;
		for (int i = 0 ; i < showLayout.length; i++){
			for (int j = 0 ; j < showLayout[0].length; j++){
				if (showLayout[i][j].getSeatId().equals(seatId)==true){
					check = true;
					if(showLayout[i][j].isOccupied()){
						return false;
					}
				}
				
			}
		}
		return check;
	}
	public void printCinema()
	{
		System.out.println("\t=====================Screen=================== ");
		System.out.print("\t ");
		for (int i =0; i<showLayout[0].length;i++){
			System.out.print(Constant.rowCode[i]+"    ");
		}
		System.out.println();
		for (int i=0; i<showLayout.length;i++){
			System.out.print((i)+"\t");
			for (int j = 0 ; j < showLayout[0].length ; j++){
				showLayout[i][j].printSeat();
			}System.out.println();
		}
	}
	public SeatItem getSeat(String seatId){
		for (int i = 0 ; i < showLayout.length; i++){
			for (int j = 0 ; j < showLayout[0].length; j++){
				if (showLayout[i][j].getSeatId().equals(seatId)){
					return showLayout[i][j];
				}
			}
		}
		return null;
	}
	public void writeShow() throws IOException{
		//find id 
		int movieId = ManageData.findMovieIndex(showMovie);
		int cineplexId = ManageData.findCineplexIndex(showCineplex);
		int cinemaId = ManageData.findCinemaIndex(showCinema);
		String data =  movieId + "," + this.showDate + "," + this.showTime + "," + cineplexId + "," + cinemaId;
		ManageData.writeData(data,"C:/data/show.txt");
	}
}
